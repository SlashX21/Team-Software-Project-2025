# ç³–åˆ†è¿½è¸ªåŠŸèƒ½ - åç«¯æ¥å£è§„èŒƒæ–‡æ¡£

## ğŸ“‹ **æ–‡æ¡£ä¿¡æ¯**
- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-01-06
- **ç”¨é€”**: åç«¯å¼€å‘å‚è€ƒè§„èŒƒ
- **åŸºç¡€URL**: `http://localhost:8080` (æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)

---

## ğŸ¯ **åŠŸèƒ½æ¦‚è¿°**

ç³–åˆ†è¿½è¸ªåŠŸèƒ½å…è®¸ç”¨æˆ·ï¼š
1. è®¾ç½®æ¯æ—¥ç³–åˆ†æ‘„å…¥ç›®æ ‡
2. è®°å½•é£Ÿç‰©çš„ç³–åˆ†æ‘„å…¥ (é£Ÿç‰©åç§° + å•ä¸ªå«ç³–é‡ + æ•°é‡)
3. æŸ¥çœ‹æ¯æ—¥ç³–åˆ†æ‘„å…¥è¿›åº¦å’Œç»Ÿè®¡
4. ç®¡ç†ç³–åˆ†æ‘„å…¥è®°å½•

---

## ğŸ”§ **é€šç”¨è§„èŒƒ**

### **è¯·æ±‚æ ¼å¼**
- Content-Type: `application/json`
- æ‰€æœ‰æ—¶é—´ä½¿ç”¨ISO 8601æ ¼å¼: `YYYY-MM-DDTHH:mm:ssZ`
- ç³–åˆ†å•ä½ç»Ÿä¸€ä¸ºæ¯«å…‹(mg)

### **å“åº”æ ¼å¼**
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

### **é”™è¯¯å“åº”**
```json
{
  "code": 400/404/500,
  "message": "é”™è¯¯æè¿°",
  "data": null
}
```

---

## ğŸ“ **æ¥å£è¯¦ç»†è§„èŒƒ**

### **1. æ·»åŠ ç³–åˆ†è®°å½•**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `POST /user/{userId}/sugar-tracking/record`
- **æè¿°**: ç”¨æˆ·æ·»åŠ é£Ÿç‰©ç³–åˆ†æ‘„å…¥è®°å½•

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |

#### **è¯·æ±‚ä½“**
```json
{
  "foodName": "å·§å…‹åŠ›é¥¼å¹²",              // string, å¿…å¡«: é£Ÿç‰©åç§°
  "sugarAmountMg": 8000.0,             // number, å¿…å¡«: å•ä¸ªé£Ÿå“å«ç³–é‡(æ¯«å…‹)
  "quantity": 3.0,                     // number, å¿…å¡«: é£Ÿå“æ•°é‡
  "consumedAt": "2025-01-06T15:30:00Z" // string, å¯é€‰: æ‘„å…¥æ—¶é—´(é»˜è®¤å½“å‰æ—¶é—´)
}
```

#### **å­—æ®µè¯´æ˜**
- `foodName`: ç”¨æˆ·è¾“å…¥çš„é£Ÿç‰©åç§°ï¼Œå¦‚"è‹¹æœ"ã€"å¯ä¹"
- `sugarAmountMg`: å•ä¸ªé£Ÿå“çš„å«ç³–é‡ï¼Œä»¥æ¯«å…‹ä¸ºå•ä½
- `quantity`: é£Ÿå“æ•°é‡ï¼Œå¯ä»¥æ˜¯å°æ•°ï¼Œå¦‚1.5ä¸ªè‹¹æœ
- `consumedAt`: æ‘„å…¥æ—¶é—´ï¼Œå‰ç«¯å¯é€‰æ‹©æ—¶é—´ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´

#### **ä¸šåŠ¡é€»è¾‘**
```
æ€»ç³–åˆ†æ‘„å…¥ = sugarAmountMg Ã— quantity
```

#### **æˆåŠŸå“åº” (201)**
```json
{
  "code": 201,
  "message": "Sugar record added successfully",
  "data": {
    "id": "123",                        // string: æ–°åˆ›å»ºçš„è®°å½•ID
    "foodName": "å·§å…‹åŠ›é¥¼å¹²",
    "sugarAmountMg": 8000.0,            // å•ä¸ªé£Ÿå“å«ç³–é‡
    "quantity": 3.0,                    // æ•°é‡
    "totalSugarMg": 24000.0,            // æ€»ç³–åˆ†æ‘„å…¥(è®¡ç®—å€¼)
    "consumedAt": "2025-01-06T15:30:00Z",
    "createdAt": "2025-01-06T15:30:00Z"
  }
}
```

---

### **2. è·å–æ¯æ—¥ç³–åˆ†æ•°æ®**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `GET /user/{userId}/sugar-tracking/daily/{date}`
- **æè¿°**: è·å–ç”¨æˆ·æŒ‡å®šæ—¥æœŸçš„ç³–åˆ†æ‘„å…¥æ•°æ®å’Œè¿›åº¦

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |
| date | string | æ˜¯ | æ—¥æœŸï¼Œæ ¼å¼: YYYY-MM-DD |

#### **æˆåŠŸå“åº” (200)**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "currentIntakeMg": 43000.0,           // number: å½“æ—¥æ€»æ‘„å…¥é‡(æ¯«å…‹)
    "dailyGoalMg": 50000.0,               // number: æ¯æ—¥ç›®æ ‡(æ¯«å…‹)
    "progressPercentage": 86.0,           // number: è¿›åº¦ç™¾åˆ†æ¯”
    "status": "warning",                  // string: çŠ¶æ€ ("good", "warning", "over_limit")
    "date": "2025-01-06T00:00:00Z",      // string: æ—¥æœŸ
    "topContributors": [                  // array: ç³–åˆ†è´¡çŒ®æœ€é«˜çš„é£Ÿç‰©(æœ€å¤š5ä¸ª)
      {
        "id": "1",                        // string: è®°å½•ID
        "foodName": "è‹¹æœæ±",             // string: é£Ÿç‰©åç§°
        "sugarAmountMg": 15000.0,         // number: å•ä¸ªé£Ÿå“å«ç³–é‡(æ¯«å…‹)
        "quantity": 1.0,                  // number: æ‘„å…¥æ•°é‡
        "consumedAt": "2025-01-06T10:30:00Z" // string: æ‘„å…¥æ—¶é—´
      },
      {
        "id": "2",
        "foodName": "å·§å…‹åŠ›é¥¼å¹²",
        "sugarAmountMg": 8000.0,
        "quantity": 2.0,
        "consumedAt": "2025-01-06T14:30:00Z"
      }
    ]
  }
}
```

#### **çŠ¶æ€è¯´æ˜**
- `"good"`: æ‘„å…¥é‡ â‰¤ 70%ç›®æ ‡
- `"warning"`: æ‘„å…¥é‡ 71%-100%ç›®æ ‡  
- `"over_limit"`: æ‘„å…¥é‡ > 100%ç›®æ ‡

---

### **3. è®¾ç½®ç³–åˆ†ç›®æ ‡**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `PUT /user/{userId}/sugar-tracking/goal`
- **æè¿°**: è®¾ç½®æˆ–æ›´æ–°ç”¨æˆ·çš„æ¯æ—¥ç³–åˆ†æ‘„å…¥ç›®æ ‡

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |

#### **è¯·æ±‚ä½“**
```json
{
  "dailyGoalMg": 45000.0                  // number, å¿…å¡«: æ¯æ—¥ç³–åˆ†ç›®æ ‡(æ¯«å…‹)
}
```

#### **æˆåŠŸå“åº” (200)**
```json
{
  "code": 200,
  "message": "Sugar goal updated successfully",
  "data": {
    "dailyGoalMg": 45000.0,               // number: æ¯æ—¥ç›®æ ‡
    "createdAt": "2025-01-01T00:00:00Z",  // string: é¦–æ¬¡åˆ›å»ºæ—¶é—´
    "updatedAt": "2025-01-06T16:00:00Z"   // string: æœ€åæ›´æ–°æ—¶é—´
  }
}
```

---

### **4. è·å–ç³–åˆ†ç›®æ ‡**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `GET /user/{userId}/sugar-tracking/goal`
- **æè¿°**: è·å–ç”¨æˆ·å½“å‰çš„æ¯æ—¥ç³–åˆ†æ‘„å…¥ç›®æ ‡

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |

#### **æˆåŠŸå“åº” (200)**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "dailyGoalMg": 50000.0,               // number: æ¯æ—¥ç›®æ ‡(æ¯«å…‹)
    "createdAt": "2025-01-01T00:00:00Z",  // string: ç›®æ ‡åˆ›å»ºæ—¶é—´
    "updatedAt": "2025-01-06T10:00:00Z"   // string: ç›®æ ‡æ›´æ–°æ—¶é—´
  }
}
```

#### **æ— ç›®æ ‡å“åº” (404)**
```json
{
  "code": 404,
  "message": "Sugar goal not found",
  "data": null
}
```

---

### **5. åˆ é™¤ç³–åˆ†è®°å½•**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `DELETE /user/{userId}/sugar-tracking/record/{recordId}`
- **æè¿°**: åˆ é™¤æŒ‡å®šçš„ç³–åˆ†æ‘„å…¥è®°å½•

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |
| recordId | string | æ˜¯ | è®°å½•ID |

#### **æˆåŠŸå“åº” (200)**
```json
{
  "code": 200,
  "message": "Sugar record deleted successfully",
  "data": null
}
```

---

### **6. è·å–ç³–åˆ†å†å²ç»Ÿè®¡**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `GET /user/{userId}/sugar-tracking/history`
- **æè¿°**: è·å–ç”¨æˆ·çš„ç³–åˆ†æ‘„å…¥å†å²ç»Ÿè®¡æ•°æ®

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |

#### **æŸ¥è¯¢å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| period | string | å¦ | "week" | ç»Ÿè®¡å‘¨æœŸ ("week", "month", "year") |

#### **æˆåŠŸå“åº” (200)**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "period": "week",                     // string: ç»Ÿè®¡å‘¨æœŸ
    "averageDailyIntake": 42000.0,        // number: å¹³å‡æ¯æ—¥æ‘„å…¥é‡(æ¯«å…‹)
    "totalIntake": 294000.0,              // number: æ€»æ‘„å…¥é‡(æ¯«å…‹)
    "daysTracked": 7,                     // number: è¿½è¸ªå¤©æ•°
    "goalAchievementRate": 85.7,          // number: ç›®æ ‡è¾¾æˆç‡(%)
    "dailyBreakdown": [                   // array: æ¯æ—¥æ˜ç»†
      {
        "date": "2025-01-01",             // string: æ—¥æœŸ
        "totalIntakeMg": 38000.0,         // number: å½“æ—¥æ‘„å…¥é‡
        "goalMg": 50000.0,                // number: å½“æ—¥ç›®æ ‡
        "achievedGoal": true              // boolean: æ˜¯å¦è¾¾æˆç›®æ ‡
      }
    ]
  }
}
```

---

### **7. è·å–æœˆåº¦ç³–åˆ†ç»Ÿè®¡**

#### **æ¥å£ä¿¡æ¯**
- **URL**: `GET /sugar-tracking/{userId}/monthly`
- **æè¿°**: è·å–æŒ‡å®šæœˆä»½çš„è¯¦ç»†ç³–åˆ†ç»Ÿè®¡æ•°æ®

#### **è·¯å¾„å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| userId | int | æ˜¯ | ç”¨æˆ·ID |

#### **æŸ¥è¯¢å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| month | string | å¦ | å½“å‰æœˆ | æœˆä»½ï¼Œæ ¼å¼: YYYY-MM |

#### **æˆåŠŸå“åº” (200)**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "month": "2025-01",                   // string: æœˆä»½
    "totalDays": 31,                      // number: å½“æœˆæ€»å¤©æ•°
    "trackedDays": 28,                    // number: æœ‰è®°å½•çš„å¤©æ•°
    "averageDailyIntake": 45000.0,        // number: å¹³å‡æ¯æ—¥æ‘„å…¥é‡
    "highestIntake": 65000.0,             // number: æœ€é«˜å•æ—¥æ‘„å…¥é‡
    "lowestIntake": 25000.0,              // number: æœ€ä½å•æ—¥æ‘„å…¥é‡
    "goalAchievementDays": 20,            // number: è¾¾æˆç›®æ ‡çš„å¤©æ•°
    "topFoodContributors": [              // array: æœˆåº¦ä¸»è¦ç³–åˆ†æ¥æº
      {
        "foodName": "è‹¹æœæ±",             // string: é£Ÿç‰©åç§°
        "totalContribution": 180000.0,    // number: æ€»è´¡çŒ®ç³–åˆ†(æ¯«å…‹)
        "frequency": 12                   // number: æ‘„å…¥æ¬¡æ•°
      }
    ],
    "weeklyTrends": [                     // array: å‘¨è¶‹åŠ¿
      {
        "week": 1,                        // number: ç¬¬å‡ å‘¨
        "averageIntake": 42000.0          // number: è¯¥å‘¨å¹³å‡æ‘„å…¥é‡
      }
    ]
  }
}
```

---

## ğŸ“Š **æ•°æ®åº“è®¾è®¡å»ºè®®**

### **sugar_records è¡¨**
```sql
CREATE TABLE sugar_records (
    id VARCHAR(50) PRIMARY KEY,          -- è®°å½•ID
    user_id INT NOT NULL,                -- ç”¨æˆ·ID
    food_name VARCHAR(200) NOT NULL,     -- é£Ÿç‰©åç§°
    sugar_amount_mg DECIMAL(10,2) NOT NULL, -- å•ä¸ªé£Ÿå“å«ç³–é‡(æ¯«å…‹)
    quantity DECIMAL(8,2) NOT NULL,      -- æ•°é‡
    total_sugar_mg DECIMAL(10,2) NOT NULL, -- æ€»ç³–åˆ†æ‘„å…¥(è®¡ç®—å­—æ®µ)
    consumed_at TIMESTAMP NOT NULL,      -- æ‘„å…¥æ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_date (user_id, consumed_at),
    INDEX idx_user_id (user_id)
);
```

### **sugar_goals è¡¨**
```sql
CREATE TABLE sugar_goals (
    id INT PRIMARY KEY AUTO_INCREMENT,   -- ç›®æ ‡ID
    user_id INT NOT NULL UNIQUE,         -- ç”¨æˆ·ID(å”¯ä¸€)
    daily_goal_mg DECIMAL(10,2) NOT NULL, -- æ¯æ—¥ç›®æ ‡(æ¯«å…‹)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id)
);
```

---

## ğŸ”’ **å®‰å…¨è¦æ±‚**

1. **ç”¨æˆ·éªŒè¯**: ç¡®ä¿åªæœ‰ç™»å½•ç”¨æˆ·å¯ä»¥è®¿é—®è‡ªå·±çš„æ•°æ®
2. **å‚æ•°éªŒè¯**: éªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§
3. **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
4. **æ•°æ®èŒƒå›´æ£€æŸ¥**: 
   - ç³–åˆ†å«é‡åº”åœ¨åˆç†èŒƒå›´å†… (0-100000mg)
   - æ•°é‡åº”å¤§äº0
   - æ—¥æœŸä¸èƒ½æ˜¯æœªæ¥æ—¶é—´

---

## ğŸ§ª **æµ‹è¯•ç”¨ä¾‹å»ºè®®**

### **æ·»åŠ è®°å½•æµ‹è¯•**
1. æ­£å¸¸æ·»åŠ è®°å½•
2. ç¼ºå°‘å¿…å¡«å­—æ®µ
3. æ— æ•ˆçš„ç”¨æˆ·ID
4. ç³–åˆ†å«é‡ä¸ºè´Ÿæ•°
5. æ•°é‡ä¸º0æˆ–è´Ÿæ•°

### **è·å–æ¯æ—¥æ•°æ®æµ‹è¯•**
1. æœ‰è®°å½•çš„æ—¥æœŸ
2. æ— è®°å½•çš„æ—¥æœŸ
3. æ— æ•ˆæ—¥æœŸæ ¼å¼
4. æ— æ•ˆç”¨æˆ·ID

### **ç›®æ ‡è®¾ç½®æµ‹è¯•**
1. é¦–æ¬¡è®¾ç½®ç›®æ ‡
2. æ›´æ–°ç°æœ‰ç›®æ ‡
3. è®¾ç½®æ— æ•ˆç›®æ ‡å€¼

---

## ğŸ“ˆ **æ€§èƒ½å»ºè®®**

1. **ç´¢å¼•ä¼˜åŒ–**: åœ¨user_idå’Œæ—¥æœŸå­—æ®µä¸Šå»ºç«‹è”åˆç´¢å¼•
2. **åˆ†é¡µæŸ¥è¯¢**: å†å²è®°å½•æŸ¥è¯¢å®ç°åˆ†é¡µ
3. **ç¼“å­˜ç­–ç•¥**: è€ƒè™‘ç¼“å­˜ç”¨æˆ·ç›®æ ‡å’Œå½“æ—¥ç»Ÿè®¡æ•°æ®
4. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡æ·»åŠ è®°å½•çš„æ¥å£

---

## ğŸ¯ **æ€»ç»“**

è¯¥æ¥å£è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
- **ç®€æ´æ€§**: åªåŒ…å«æ ¸å¿ƒå¿…éœ€å­—æ®µ
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„è¯·æ±‚/å“åº”æ ¼å¼
- **æ‰©å±•æ€§**: é¢„ç•™äº†ç»Ÿè®¡å’Œå†å²æŸ¥è¯¢åŠŸèƒ½
- **ç”¨æˆ·å‹å¥½**: ç¬¦åˆç”¨æˆ·å®é™…ä½¿ç”¨ä¹ æƒ¯

è¯·æ ¹æ®æ­¤è§„èŒƒå®ç°åç«¯æ¥å£ï¼Œæœ‰ä»»ä½•ç–‘é—®è¯·åŠæ—¶æ²Ÿé€šã€‚