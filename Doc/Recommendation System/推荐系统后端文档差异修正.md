# æ¨èç³»ç»Ÿåç«¯æ–‡æ¡£å·®å¼‚ä¿®æ­£æŒ‡å—

## ğŸ“‹ æ€»è§ˆ

å½“å‰æ¨èç³»ç»Ÿå·²å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†åç«¯APIæ–‡æ¡£å­˜åœ¨ç¼ºå¤±å’Œä¸åŒ¹é…é—®é¢˜ã€‚æœ¬æ–‡æ¡£æ—¨åœ¨æŒ‡å¯¼åç«¯å›¢é˜Ÿä¿®æ­£æ–‡æ¡£ï¼Œç¡®ä¿APIè§„èŒƒä¸å®é™…å®ç°ä¸€è‡´ã€‚

## ğŸš¨ å…³é”®æ¥å£ç¼ºå¤±

### 1. æ¡ç æ¨èæ¥å£ (æ ¸å¿ƒåŠŸèƒ½)

**éœ€è¦æ·»åŠ åˆ°æ–‡æ¡£ï¼š**

```http
POST /recommendations/barcode
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": 1,
  "productBarcode": "5000112548167"
}
```

**å“åº”æ•°æ®ï¼š**
```json
{
  "success": true,
  "message": "æ¨èæˆåŠŸ",
  "data": {
    "recommendationId": "rec_20240628_0001",
    "scanType": "barcode_scan",
    "userProfileSummary": {
      "userId": 1,
      "nutritionGoal": "lose_weight",
      "age": 25,
      "gender": "male",
      "allergensCount": 2,
      "dailyCaloriesTarget": 2000,
      "preferenceConfidence": 0.75
    },
    "recommendations": [
      {
        "rank": 1,
        "product": {
          "barCode": "1234567890",
          "productName": "Healthier Alternative",
          "brand": "Health Brand",
          "category": "Beverages",
          "energyKcal100g": 180,
          "proteins100g": 8.5,
          "fat100g": 2.1,
          "sugars100g": 5.2
        },
        "recommendationScore": 0.95,
        "reasoning": "Lower sugar content and higher protein make this a better choice for your weight loss goal."
      }
    ],
    "llmAnalysis": {
      "summary": "Found 3 healthier alternatives with lower sugar content",
      "detailedAnalysis": "The original product contains 10.6g sugar per 100g...",
      "actionSuggestions": ["Consider the top-ranked alternative", "Check nutrition labels"]
    },
    "processingMetadata": {
      "algorithmVersion": "v1.0",
      "processingTimeMs": 850,
      "llmTokensUsed": 420,
      "confidenceScore": 0.8,
      "totalCandidates": 45,
      "filteredCandidates": 5
    }
  },
  "timestamp": "2024-06-28T10:30:00Z"
}
```

### 2. å°ç¥¨åˆ†ææ¥å£

**éœ€è¦æ·»åŠ åˆ°æ–‡æ¡£ï¼š**

```http
POST /recommendations/receipt
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": 1,
  "purchasedItems": [
    {
      "productName": "Coca Cola Original 330ml",
      "quantity": 2
    },
    {
      "productName": "Organic Whole Wheat Bread",
      "quantity": 1
    }
  ]
}
```

**å“åº”æ•°æ®ï¼š**
```json
{
  "success": true,
  "message": "å°ç¥¨åˆ†æå®Œæˆ",
  "data": {
    "recommendationId": "rec_receipt_20240628_0001",
    "scanType": "receipt",
    "userProfileSummary": {
      "userId": 1,
      "nutritionGoal": "maintain"
    },
    "itemAnalyses": [
      {
        "originalItem": {
          "productName": "Coca Cola Original 330ml",
          "quantity": 2,
          "productInfo": {
            "barCode": "5000112548167",
            "category": "Beverages"
          }
        },
        "alternatives": [
          {
            "rank": 1,
            "product": {
              "barCode": "1234567890",
              "productName": "Diet Cola Alternative",
              "category": "Beverages"
            },
            "recommendationScore": 0.88,
            "reasoning": "Lower sugar alternative"
          }
        ]
      }
    ],
    "overallNutritionAnalysis": {
      "totalCalories": 650,
      "totalProtein": 15.2,
      "totalFat": 8.5,
      "goalMatchPercentage": 75
    }
  },
  "timestamp": "2024-06-28T10:30:00Z"
}
```

### 3. æ¨èç³»ç»Ÿå¥åº·æ£€æŸ¥æ¥å£

**éœ€è¦æ·»åŠ åˆ°æ–‡æ¡£ï¼š**

```http
GET /recommendations/health
```

**å“åº”æ•°æ®ï¼š**
```json
{
  "success": true,
  "message": "æ¨èæœåŠ¡è¿è¡Œæ­£å¸¸",
  "data": {
    "status": "healthy",
    "version": "1.0.0",
    "uptime": "2 days 5 hours",
    "lastRecommendation": "2024-06-28T10:25:00Z"
  },
  "timestamp": "2024-06-28T10:30:00Z"
}
```

## ğŸ“Š æ•°æ®åº“è¡¨æ˜ å°„ä¿®æ­£

### 1. RECOMMENDATION_LOGè¡¨è¡¥å……

**å½“å‰æ–‡æ¡£ç¼ºå°‘çš„è¡¨ï¼Œéœ€è¦æ·»åŠ ï¼š**

```sql
CREATE TABLE RECOMMENDATION_LOG (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    request_barcode VARCHAR(255),
    request_type ENUM('barcode_scan', 'receipt_scan') NOT NULL,
    recommended_products TEXT, -- JSONæ ¼å¼
    algorithm_version VARCHAR(20) DEFAULT 'v1.0',
    llm_prompt TEXT,
    llm_response TEXT,
    llm_analysis TEXT, -- JSONæ ¼å¼
    processing_time_ms INT,
    total_candidates INT,
    filtered_candidates INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES USER(user_id) ON DELETE CASCADE
);
```

### 2. SCAN_HISTORYè¡¨å­—æ®µä¿®æ­£

**å½“å‰æ–‡æ¡£ä¸­çš„å­—æ®µï¼š**
```json
{
  "analysis": {
    "isHealthy": false,
    "sugarContent": "35g per 330ml",
    "warnings": ["High sugar content"]
  }
}
```

**å®é™…æ•°æ®åº“å­—æ®µï¼š**
- `scan_result` TEXT - å­˜å‚¨åŸºç¡€æ‰«æç»“æœ
- **æ²¡æœ‰ç»“æ„åŒ–çš„analysiså­—æ®µ**

**å»ºè®®ï¼š** ä¿æŒç°æœ‰`scan_result`å­—æ®µï¼Œä¸è¦æ·»åŠ å¤æ‚çš„analysisç»“æ„

## ğŸ”§ å­—æ®µç±»å‹å’Œå‘½åä¿®æ­£

### 1. ç”¨æˆ·åå¥½æ¥å£å­—æ®µå¯¹é½

**æ–‡æ¡£ä¸­GET /user/{userId}/preferenceså“åº”éœ€è¦æ·»åŠ ï¼š**

```json
{
  "nutritionPreferences": {
    "preferLowSugar": true,
    "preferLowFat": false,
    "preferHighProtein": true,
    "preferLowSodium": true,
    "preferOrganic": false,
    "preferLowCalorie": true,
    "preferenceSource": "user_manual"
  },
  "inferenceConfidence": 0.85,
  "version": 2
}
```

### 2. è¿‡æ•åŸæ•°æ®å­—æ®µç¡®è®¤

**æ–‡æ¡£å­—æ®µä¸æ•°æ®åº“åŒ¹é…åº¦ï¼š** âœ… æ­£ç¡®

**USER_ALLERGENè¡¨å­—æ®µï¼š**
- `severity_level` ENUM('mild', 'moderate', 'severe')
- `confirmed` BOOLEAN
- `notes` TEXT

### 3. äº§å“ä¿¡æ¯å­—æ®µç¡®è®¤

**PRODUCTè¡¨å…³é”®å­—æ®µï¼š**
- `bar_code` VARCHAR(255) - æ³¨æ„æ˜¯ä¸‹åˆ’çº¿å‘½å
- `product_name` VARCHAR(250)
- `energy_kcal_100g` FLOAT - æ³¨æ„å­—æ®µåæ ¼å¼

## ğŸš« æš‚ä¸å®ç°çš„åŠŸèƒ½

**æ–‡æ¡£ä¸­ä»¥ä¸‹æ¥å£å½“å‰æ¨èç³»ç»Ÿæœªå®ç°ï¼Œå»ºè®®æ ‡è®°ä¸ºTODOï¼š**

1. `POST /recommendations/history-based`
2. `POST /recommendations/nutritional-complement`
3. ç³–åˆ†è¿½è¸ªç›¸å…³æ¥å£ (SUGAR_INTAKE_HISTORYè¡¨)
4. è¥å…»ç›®æ ‡è®¡ç®—æ¥å£çš„é«˜çº§å­—æ®µ (sugarã€fiberã€sodium)

## ğŸ“ APIå“åº”æ ¼å¼ç»Ÿä¸€

**æ‰€æœ‰æ¨èç›¸å…³æ¥å£éƒ½åº”ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ï¼š**

```json
{
  "success": boolean,
  "message": string,
  "data": object,
  "timestamp": "ISO 8601 format"
}
```

**é”™è¯¯å“åº”æ ¼å¼ï¼š**

```json
{
  "success": false,
  "message": "æ¨èç”Ÿæˆå¤±è´¥",
  "error": {
    "code": "RECOMMENDATION_FAILED",
    "details": "ç”¨æˆ·ç”»åƒæ•°æ®ä¸å®Œæ•´"
  },
  "timestamp": "2024-06-28T10:30:00Z"
}
```

## ğŸ”„ ä¿®æ”¹ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ (ç«‹å³ä¿®æ”¹)
1. âœ… æ·»åŠ æ¡ç æ¨èæ¥å£æ–‡æ¡£
2. âœ… æ·»åŠ å°ç¥¨åˆ†ææ¥å£æ–‡æ¡£
3. âœ… æ·»åŠ RECOMMENDATION_LOGè¡¨å®šä¹‰
4. âœ… ä¿®æ­£ç”¨æˆ·åå¥½æ¥å£å­—æ®µ

### ä¸­ä¼˜å…ˆçº§ (ä¸‹ä¸ªè¿­ä»£)
1. ğŸ“‹ æ·»åŠ æ¨èå†å²æŸ¥è¯¢æ¥å£
2. ğŸ“‹ å®Œå–„é”™è¯¯å¤„ç†æ–‡æ¡£
3. ğŸ“‹ æ·»åŠ æ¥å£é™æµè§„èŒƒ

### ä½ä¼˜å…ˆçº§ (æœªæ¥è§„åˆ’)
1. ğŸ”® é«˜çº§æ¨èåŠŸèƒ½æ¥å£
2. ğŸ”® ç³–åˆ†è¿½è¸ªé›†æˆ
3. ğŸ”® è¥å…»è®¡ç®—å¢å¼º

---

**æ³¨æ„ï¼š** æœ¬æ–‡æ¡£ä¸“æ³¨äºå·²å®ç°åŠŸèƒ½çš„æ¥å£è§„èŒƒåŒ–ï¼Œä¸æ¶‰åŠæ–°åŠŸèƒ½å¼€å‘ã€‚æ‰€æœ‰ä¿®æ”¹éƒ½åº”ä¿æŒä¸ç°æœ‰æ¨èç³»ç»Ÿå®ç°çš„å…¼å®¹æ€§ã€‚